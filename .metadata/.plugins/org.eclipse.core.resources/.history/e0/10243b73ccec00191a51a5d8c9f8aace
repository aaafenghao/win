package com.example.demo.lock.weight;

import org.openjdk.jol.info.ClassLayout;

import com.example.demo.lock.A;

public class WeightHeader {
	
	static A a;
	public static void main(String[] args) throws Exception {
		a = new A();
		System.out.println("--- before lock"+ClassLayout.parseInstance(a).toPrintable());
		
		Thread thread = new Thread() {
			@Override
			public void run() {
				synchronized (a) {
					try {
						Thread.sleep(5000);
						System.out.println("--- release lock");
					}catch (Exception ignore) {
					}
				}
			};
		};
		thread.start();
		Thread.sleep(1000);
		//thread   线程内部加锁中
		System.out.println("--- lock ing"+ClassLayout.parseInstance(a).toPrintable()); 
		// 尝试加锁,应该会导致对象信息变化
		sync(); 
		
		System.out.println("--- after lock"+ClassLayout.parseInstance(a).toPrintable());
		
		System.gc();
		System.out.println("--- after gc"+ClassLayout.parseInstance(a).toPrintable());
		
	
	}
	
	public static void sync() {
		synchronized (a) {
			System.out.println("--- main lock"+ClassLayout.parseInstance(a).toPrintable());
		}
	}

}
