package com.example.demo.lock.weight;

import org.openjdk.jol.info.ClassLayout;

import com.example.demo.lock.A;

public class WeightHeader {
	
	static A a;
	public static void main(String[] args) throws Exception {
		a = new A();
		System.out.println("--- before lock");
		System.out.println(ClassLayout.parseInstance(a).toPrintable());
		
		Thread thread = new Thread() {
			@Override
			public void run() {
				synchronized (a) {
					try {
						Thread.sleep(5000);
						System.out.println("--- release lock");
					}catch (Exception ignore) {
					}
				}
			};
		};
		thread.start();
		Thread.sleep(1000);
		
		System.out.println("--- lock ing");   //thread   线程内部加锁中
		System.out.println(ClassLayout.parseInstance(a).toPrintable());
		sync(); // 尝试加锁
		
		System.out.println("--- after lock");
		System.out.println(ClassLayout.parseInstance(a).toPrintable());
		
		System.gc();
		System.out.println("--- after gc");
		System.out.println(ClassLayout.parseInstance(a).toPrintable());
	}
	
	public static void sync() {
		synchronized (a) {
			System.out.println("--- main lock");
			System.out.println(ClassLayout.parseInstance(a).toPrintable());
		}
	}

}
